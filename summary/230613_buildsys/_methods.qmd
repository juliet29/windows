# Methods

TODO brief overview here...

## Data Collection 

We collected data for short periods of time over three months in the summer. We placed HOBO sensors **(sensor name) temperature/ relative humidity sensors in two adjacent rooms in a multi-family residential building. The opening and closing schedules were not determined beforehand but were allowed to proceed naturally. This created three distinct scenarios for testing the efficacy of the model we developed. 

Descriptions of the data are provided in @tbl-data-collected. The experiments are labeled as experiments A, B, and C, corresponding to data recorded at the beginning on July 20, July 27, and September 8 respectively. Experiment B was much longer than the other experiments, about 14 days vs experiments A and C were collected over 3 and 4 days each. Experiment B also had a much shorter period of the window being open, with the window open around 5 percent of the time, vs experiments A and C which had the window open for at least 20 percent of the time. [^0] [^1]

[^1]: *TODO: check this => i think opening percentage for b should be much higher?? Or maybe include plots of the real data*
[^0]: TODO not sure if really need to discuss the average opening time...

![Data Collected](temp_figs/data_collected_table.png){#tbl-data-collected}

To develop an understanding of how temperature and relative humidity, the quantities that were measured, changed across the different experiments, we examined the distributions of the data in @fig-data-collected. We observe that experiment B had the widest distribution of internal temperatures. Experiment C had internal temperatures that were higher and closer to the mean/median** of the external temperatures. This was due to observed higher temperatures during this time period, which makes for a particularly interesting edge case. The internal relative humidity was higher than the ambient relative humidity across experiments. 

![Distributions of Temperature and Relative Humididty Across Experiments](temp_figs/data_collected.jpg){#fig-data-collected}



## Detection Methods

some intro here [^3] 

### Smoothing Technique

Our approach relies on an intuitive understanding of window operation detection. We expect a typical time series recording of a quantity of interest, such as temperature or relative humidity, to contain information that reflects the seasonality of ambient quantities, noise due to occurrences within the space where measurements are being taken, and the desired signal of due to a change in the window state. The way in which these three components of a measurement are combined is unknown, and, the noise component in particular cannot be known based on the measurements we have collected. Therefore, our task is to attempt to extricate the seasonality that is due to ambient processes from the measured data, which will ideally reveal the window detection and a bit of noise.

To remove the seasonality from the measured data, we examined three methods of de-seasonalizing: using seasonal-trend-decomposition, using a sinusoidal fit, and using an exponentially weighted mean function. These all reflect a trade-off between capturing pure seasonality and capturing a bit of noise. The sinusoidal method, which is optimized for the indoor temperature time series, purely reflects seasonality whereas the exponentially weighted mean function is simply a moving average of the indoor temperature signal. Therefore, some noise is captured as well. The seasonal component of a seasonal trend decomposition is somewhere in the middle. We found that the exponentially weighted mean function performed the best in isolating window detection, which follows from our intuition that both the seasonal components and noise need to be isolated. [^4]

The smoothing technique proceeds as follows. The goal is to identify $W(t)$, window state as a function of time. This can take on two values: 0, representing window closed, or 1, representing window open. We have an observed variable $T(t)$, which represents the measurement of the indoor temperature. We apply an exponentially weighted mean function to the observed temperature, creating a smoothed time series, $\overline{T(t)}$, which in theory removes strong peaks that would reflect changes in window state, and isolates information concerning the seasonal response and additional noise [^2]. Subtracting  $\overline{T(t)}$ from $T(t)$ yields $T'(t)$, which is a time series that reflects changes in the window state and some additional noise. In order to more confidently identify the where the changes in window state occur, we examine the first and second derivatives of $T'(t)$, $\frac{dT'(t)}{dt}$ and $\frac{d^2T'(t)}{dt^2}$. Observing the second derivative in particlar, is an effective way to identify change points. In order to predict where window changes occur, we apply a hypothesis test[^5]. We assume that the time series  $\frac{d^2T'(t)}{dt^2}$ is normally distributed. Therefore, any value in  $\frac{d^2T'(t)}{dt^2}$ that is more than 2 standard deviations away from the mean is unlikely to occur, and could possibly indicate an instance of a change in window state.   We will call these initiall guesses $G(t)$. They take on positive or negative values depending on whether they are predicting a transition from window open to close, or window close to open. Therefore, we round the values of $G(t)$ to 0 or 1 to reflect this. Finally, we interploate between the rounded values of  $G(t)$, so that we only predict a change in window state when $G(t)$ transitions between 0 and 1. This prediction of the window state is called $I(t)$. We have included @fig-smoothing-tech to show how the smoothing techique for window detection works. 

![Smoothing Technique in Action ]{#fig-smoothing-tech}



[^2]: this assumes that the ewm function is perfectly able to capture seasonality, which in reality it isn't...=> need to write down assumptipns => that the instantaneous change in indoor temp due to window opening is greater than any other potential source of instantanous temperature change. 
[^3]: TODO: include this part: We anticipate that creating a physical model to more explicitly determine the response of the indoor temperature based on the ambient temperature and the building makeup could be an interesting approach to capture the "truth", or at least approximate it Also need some discussion about the emphasis identifying where the window state changes...
[^4]: TODO: i think the previous 2 paragraphs can be condensed or removed entirely
[^5]: is hypothesis test the right word?, should i use vocabulary like the null hypothesis and the alternative hypothesis??

### Machine Learning Method

## Evaluation Metrics

### Standard Metrics

### De Rautlin de Roy Metrics 

### Custom Metrics 

